# Rime schema settings
# encoding: utf-8

schema:
  schema_id: wubi
  name: '五笔'
  version: '2026.1'
  icon: icons/CN.ico
  ascii_icon: icons/EN.ico
  full_icon: icons/full.ico
  half_icon: icons/half.ico
  author:
    - 发明人 王永民先生
  description: |
    98 版五笔输入法方案。敲 z 键进入临时拼音
  dependencies:
    - pinyin

switches:
  - name: ascii_mode
    reset: 0
    states: [中, 英]
  - name: zh_trad
    reset: 0
    states: [简体, 繁体]
  - name: full_shape
    reset: 0
    states: [半角, 全角]
  - name: extended_charset
    reset: 1
    states: [常用, 扩展]
  - name: ascii_punct
    reset: 0
    states: [。，, ．，]

# 输入引擎核心配置
engine:
  # 处理器：处理键盘输入
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor

  # 分段器：将输入分段处理
  segmentors:
    - ascii_segmentor
    - matcher
    - affix_segmentor@tmp_pinyin
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor

  # 转换器：生成候选词
  translators:
    - punct_translator
    - reverse_lookup_translator
    # - table_translator@pinyin_translator
    - table_translator
    - lua_translator@*date_time_translator
    - history_translator@last_input
  # 过滤器：对候选词进行处理
  filters:
    - simplifier
    - uniquifier

# 拼写器配置
speller:
  auto_select: false # 是否自动选择
  auto_clear: max_length # 自动清除编码
  delimiter: '`' # 分隔符
  max_code_length: 4 # 最大编码长度 (五笔)
  alphabet: ;zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA` # 字母表
  initials: ;zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA` # 首字母
  auto_select_pattern: ^;.$|^\w{4}$ # 自动选择模式
  algebra: # 万能z键拼写处理，z符号匹配任意字符
    - erase/^z/
    - derive/^(...).$/$1z/ # 三码后z匹配一码
    - derive/^(..).(.*)$/$1z$2/ # 两码后z匹配剩余
    - derive/^(.).(.*)$/$1z$2/ # 一码后z匹配剩余
    # - derive/^.(.*)$/z$1/  # 开启本行将与z键重复上屏冲突

# 主翻译器配置
translator:
  dictionary: wubi.extended
  db_class: tabledb
  initial_quality: 100000
  # 是否开启字符集过滤
  enable_charset_filter: false
  # 是否对已上屏词自动成词
  encode_commit_history: false
  # 最大词组长度
  max_phrase_length: 4
  # 提前显示尚未输入完整码的字
  enable_completion: true
  # preedit_format:
  #   - 'xform/^([a-z]*)$/$1\t〈\U$1\E〉/'  # 注释掉本行将只显示键名提示而不显示英文编码提示
  #   - "xlit|ABCDEFGHIJKLMNOPQRSTUVWXY|工子又大月土王目水日口田山已火之金白木禾立女人幺言|"
  disable_user_dict_for_patterns:
    - '^z.*$' # 禁用Z键的用户词典
  # 是否开启自动造词。需要启用自动造词，需要同时将 enable_encoder、enable_sentence、enable_user_dict 设置为 true
  enable_encoder: false
  # 是否开启自动造句
  enable_sentence: false
  # 是否开启用户词典（用户词典记录动态字词频、用户词）
  enable_user_dict: false

# 拼音反查配置 (Z键触发)
reverse_lookup:
  tag: tmp_pinyin
  prefix: z
  tips: '〈拼音反查〉'
  db_class: tabledb
  dictionary: pinyin
  enable_charset_filter: false
  enable_completion: false
  enable_encoder: false
  enable_sentence: false
  enable_user_dict: false
  encode_commit_history: false
  initial_quality: 1.2
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue/$1üe/
    - xform/([jqxy])v/$1u/
  disable_user_dict_for_patterns:
    - '^z.*$'

# pinyin_translator:
#   # tag: tmp_pinyin
#   # prefix: 'z'
#   # tips: '〈临时拼音〉'
#   extra_tags:
#     - tmp_pinyin
#   db_class: tabledb
#   dictionary: pinyin
#   enable_charset_filter: false
#   enable_completion: true
#   enable_encoder: false
#   enable_sentence: false
#   enable_user_dict: false
#   encode_commit_history: false
#   enable_word_completion: true
#   spelling_hints: 8
#   initial_quality: 1.2
#   preedit_format:
#     - xform/([nl])v/$1ü/
#     - xform/([nl])ue/$1üe/
#     - xform/([jqxy])v/$1u/
#   disable_user_dict_for_patterns:
#     - '^z.*$'

# 简繁体转换配置
simplifier:
  opencc_config: s2t.json # OpenCC 配置文件
  option_name: zh_trad # 对应的开关名称

# 识别器配置
recognizer:
  import_preset: default
  patterns:
    uppercase: "[A-Z][-_+.'0-9A-Za-z]*$" # 大写字母
    url: '^(www[.]|https?:|ftp[.:]|mailto:|file:).*$|^[a-z]+[.].+$' # URL识别
    email: '^[A-Za-z][-_.0-9A-Za-z]*@.*$' # 邮箱识别
    tmp_pinyin: '^z[a-z]*$' # 临时拼音

# 历史记录配置
last_input:
  input: z
  size: 1
  initial_quality: 1

# 按键绑定配置
key_binder:
  bindings:
    # 菜单导航
    - { send: Up, accept: Left, when: has_menu } # 左箭头上翻页
    - { send: Down, accept: Right, when: has_menu } # 右箭头下翻页
    - { send: Page_Up, accept: minus, when: has_menu } # 减号上翻页
    - { send: Page_Down, accept: equal, when: has_menu } # 等号下翻页
    - { send: Escape, accept: space, when: composing } # ESC清编码
    - { send: space, accept: space, when: has_menu } # 空格确认

    # 使用 [] 上下翻页
    - { when: has_menu, accept: bracketleft, send: Page_Up }
    - { when: has_menu, accept: bracketright, send: Page_Down }
    # 候选2 用逗号选择
    - { when: has_menu, accept: comma, send: 2 }
    # 候选3 用句号选择
    - { when: has_menu, accept: period, send: 3 }

    # # 全角半角切换
    # - { when: always, accept: Control+Alt+space, toggle: full_shape } # Ctrl+Alt+空格

    # 中英文标点切换
    - { when: always, accept: Control+Alt+period, toggle: ascii_punct } # Ctrl+Alt+.

# 标点配置
punctuator:
  import_preset: symbols # 导入符号预设
